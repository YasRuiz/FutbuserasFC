<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Pago Exitoso</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <h1>Â¡Pago exitoso!</h1>
  <p>Redirigiendo y enviando pedido por WhatsApp...</p>

  <script>
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const usuario = JSON.parse(localStorage.getItem("usuarioActivo")) || {}; // corregido
    const metodoPago = localStorage.getItem("metodoPago") || "WebPay";
    const banco = localStorage.getItem("bancoSeleccionado") || "";
    let total = 0;

    if (carrito.length === 0) {
      alert("No hay productos en el carrito.");
      window.location.href = "tienda.html";
    }

    let mensaje = `ðŸŸ£ Pedido Futbuseras FC:%0A`;

    carrito.forEach(p => {
      mensaje += `- ${p.nombre}: $${p.precio} CLP%0A`;
      total += p.precio;
    });

    mensaje += `%0ATotal: $${total} CLP%0A`;
    mensaje += `%0ADatos del Cliente:%0A`;

    if (usuario.rut) {
      mensaje += `Nombre: ${usuario.nombre} ${usuario.apellido}%0A`;
      mensaje += `RUT: ${usuario.rut}%0A`;
      mensaje += `Correo: ${usuario.correo}%0A`;
      mensaje += `TelÃ©fono: ${usuario.telefono}%0A`;
    } else {
      mensaje += `Correo: ${usuario.correo || "No disponible"}%0A`;
    }

    mensaje += `%0AMedio de Pago: ${metodoPago}`;
    if (banco) mensaje += ` (%0ABanco: ${banco})`;

    const numero = "56975357329";
    const url = `https://wa.me/${numero}?text=${mensaje}`;

    window.onload = () => {
      window.open(url, "_blank");
      localStorage.removeItem("carrito");
      setTimeout(() => {
        window.location.href = "index.html";
      }, 4000);
    };
  </script>
</body>
</html>
