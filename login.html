<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Iniciar o Crear Cuenta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <section>
    <h2>Ingresa a tu cuenta</h2>
    <form id="form-login">
      <input type="email" id="loginEmail" placeholder="Correo" required />
      <input type="password" id="loginClave" placeholder="Contraseña" required minlength="6" />
      <button type="submit">Iniciar sesión</button>
    </form>
  </section>

  <section>
    <h2>¿No tienes cuenta? Crea una</h2>
    <form id="form-crear-cuenta">
      <input type="text" id="rut" placeholder="RUT (Ej: 12345678-9)" maxlength="10" required />
      <input type="text" id="nombre" placeholder="Nombre" required />
      <input type="text" id="apellido" placeholder="Apellido" required />
      <input type="email" id="correoNuevo" placeholder="Correo electrónico" required />
      <input type="tel" id="telefono" placeholder="Teléfono" required pattern="[0-9]+" maxlength="15" />
      <input type="password" id="claveNueva" placeholder="Crea una contraseña" required minlength="6" />
      <button type="submit">Crear cuenta</button>
    </form>
    <p id="mensaje-usuario" style="color: #ff00cc; text-align: center;"></p>
  </section>

  <script>
    const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

    function validarRUT(rut) {
      return /^\d{8}-\d{1}$/.test(rut);
    }

    function soloLetras(valor) {
      return /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(valor);
    }

    // Login
    document.getElementById("form-login").addEventListener("submit", function (e) {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const clave = document.getElementById("loginClave").value.trim();

      const usuario = usuarios.find(u => u.correo === email && u.clave === clave);
      if (usuario) {
        localStorage.setItem("usuarioActivo", JSON.stringify(usuario));
        window.location.href = "pago.html";
      } else {
        alert("Correo o contraseña incorrectos.");
      }
    });

    // Crear cuenta
    document.getElementById("form-crear-cuenta").addEventListener("submit", function (e) {
      e.preventDefault();

      const rut = document.getElementById("rut").value.trim();
      const nombre = document.getElementById("nombre").value.trim();
      const apellido = document.getElementById("apellido").value.trim();
      const correo = document.getElementById("correoNuevo").value.trim();
      const telefono = document.getElementById("telefono").value.trim();
      const clave = document.getElementById("claveNueva").value.trim();
      const mensaje = document.getElementById("mensaje-usuario");

      if (!validarRUT(rut)) {
        mensaje.textContent = "Formato de RUT inválido. Debe ser 8 dígitos, guion, 1 dígito (ej: 12345678-9).";
        return;
      }

      if (!soloLetras(nombre) || !soloLetras(apellido)) {
        mensaje.textContent = "Nombre y Apellido solo deben contener letras.";
        return;
      }

      if (!/^\d{9,15}$/.test(telefono)) {
        mensaje.textContent = "El teléfono debe contener solo números (entre 9 y 15 dígitos).";
        return;
      }

      if (usuarios.find(u => u.rut === rut || u.correo === correo)) {
        mensaje.textContent = "Usuario ya existe. Recupera tu clave.";
        return;
      }

      const nuevoUsuario = { rut, nombre, apellido, correo, telefono, clave };
      usuarios.push(nuevoUsuario);
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      localStorage.setItem("usuarioActivo", JSON.stringify(nuevoUsuario));

      mensaje.textContent = "Cuenta creada con éxito. Redirigiendo al pago...";
      setTimeout(() => {
        window.location.href = "pago.html";
      }, 1500);
    });
  </script>
</body>
</html>