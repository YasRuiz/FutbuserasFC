<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Iniciar Sesión o Crear Cuenta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <section>
    <h1>Iniciar Sesión</h1>
    <form id="loginForm">
      <input type="text" id="correoLogin" placeholder="Correo">
      <input type="password" id="claveLogin" placeholder="Clave">
      <button type="submit">Ingresar</button>
    </form>
  </section>

  <section>
    <h2>¿No tienes cuenta? Regístrate</h2>
    <form id="registroForm">
      <input type="text" id="rut" placeholder="RUT (ej: 12345678-9)">
      <input type="text" id="nombre" placeholder="Nombre">
      <input type="text" id="apellido" placeholder="Apellido">
      <input type="text" id="correo" placeholder="Correo">
      <input type="text" id="telefono" placeholder="Teléfono (solo números)">
      <input type="password" id="clave" placeholder="Clave">
      <button type="submit">Crear Cuenta</button>
    </form>
  </section>

  <script>
    // LOGIN
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const correo = document.getElementById("correoLogin").value.trim();
      const clave = document.getElementById("claveLogin").value.trim();

      if (!correo || !clave) {
        alert("Debes ingresar tu correo y clave");
        return;
      }

      const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
      const user = usuarios.find(u => u.correo === correo && u.clave === clave);

      if (user) {
        localStorage.setItem("usuario", JSON.stringify(user));
        alert("Bienvenido/a " + user.nombre);
        window.location.href = "pago.html";
      } else {
        alert("Usuario o clave incorrecta");
      }
    });

    // REGISTRO
    document.getElementById("registroForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const rut = document.getElementById("rut").value.trim();
      const nombre = document.getElementById("nombre").value.trim();
      const apellido = document.getElementById("apellido").value.trim();
      const correo = document.getElementById("correo").value.trim();
      const telefono = document.getElementById("telefono").value.trim();
      const clave = document.getElementById("clave").value.trim();

      const errores = [];

      if (!/^\d{8}-[\dkK]$/.test(rut)) {
        errores.push("El RUT debe tener el formato 12345678-9");
      }

      if (!/^[A-Za-zÁÉÍÓÚÑáéíóúñ ]+$/.test(nombre)) {
        errores.push("El nombre solo debe contener letras");
      }

      if (!/^[A-Za-zÁÉÍÓÚÑáéíóúñ ]+$/.test(apellido)) {
        errores.push("El apellido solo debe contener letras");
      }

      if (!/^\d{9}$/.test(telefono)) {
        errores.push("El teléfono debe tener 9 dígitos");
      }

      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(correo)) {
        errores.push("Correo inválido");
      }

      if (!clave || clave.length < 4) {
        errores.push("La clave debe tener al menos 4 caracteres");
      }

      const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
      const existe = usuarios.some(u => u.correo === correo);

      if (existe) {
        errores.push("El usuario ya existe. Recupera tu clave.");
      }

      if (errores.length > 0) {
        alert(errores.join("\n"));
        return;
      }

      const nuevoUsuario = { rut, nombre, apellido, correo, telefono, clave };
      usuarios.push(nuevoUsuario);
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      localStorage.setItem("usuario", JSON.stringify(nuevoUsuario));

      alert("Cuenta creada correctamente. Serás redirigido al pago.");
      window.location.href = "pago.html";
    });
  </script>
</body>
</html>